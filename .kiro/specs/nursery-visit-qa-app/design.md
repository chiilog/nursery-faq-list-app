# è¨­è¨ˆæ›¸

## æ¦‚è¦

ä¿è‚²åœ’ãƒ»å¹¼ç¨šåœ’è¦‹å­¦è³ªå•ãƒªã‚¹ãƒˆç®¡ç†ã‚¢ãƒ—ãƒªã¯ã€PWAï¼ˆProgressive Web Appï¼‰ã¨ã—ã¦å®Ÿè£…ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆè¨­è¨ˆã‚’æ¡ç”¨ã—ã¾ã™ã€‚ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã®ä½¿ã„ã‚„ã™ã•ã‚’æœ€å„ªå…ˆã¨ã—ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚’æä¾›ã™ã‚‹ç¾ä»£çš„ãª Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PWA Frontend              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   React     â”‚ â”‚  Service Worker â”‚â”‚
â”‚  â”‚ Components  â”‚ â”‚  (Offline Cache)â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   IndexedDB     â”‚ â”‚  Supabase Auth  â”‚
â”‚ (Offline Cache) â”‚ â”‚   & Realtime    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AWS Amplify   â”‚ â”‚    Supabase     â”‚
â”‚   (Hosting)     â”‚ â”‚  (PostgreSQL)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: React 19 + TypeScript + Vite
- **UI ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Chakra UI v3 + Emotion
- **çŠ¶æ…‹ç®¡ç†**: Zustandï¼ˆè»½é‡ã§ã‚·ãƒ³ãƒ—ãƒ«ï¼‰
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API**: Supabaseï¼ˆPostgreSQLã€REST APIï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Supabaseï¼ˆPostgreSQLã€ã‚¯ãƒ©ã‚¦ãƒ‰å‹ï¼‰
- **èªè¨¼**: Supabase Authï¼ˆOAuthå¯¾å¿œï¼‰
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡**: Supabase Realtimeï¼ˆWebSocketï¼‰
- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: IndexedDBï¼ˆDexie.js ãƒ©ãƒƒãƒ‘ãƒ¼ä½¿ç”¨ï¼‰
- **PWA**: Workboxï¼ˆService Worker ç®¡ç†ï¼‰
- **ãƒ†ã‚¹ãƒˆ**: Vitest + React Testing Library
- **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: AWS Amplify Hosting

#### çµ±åˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ§‹æˆã®é¸æŠç†ç”±

**Supabaseï¼ˆãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰**:

- **OAuthèªè¨¼**: Google/LINEç°¡å˜è¨­å®š
- **PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: é«˜æ©Ÿèƒ½ãƒ»é«˜ä¿¡é ¼æ€§
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½**: WebSocket ãƒ™ãƒ¼ã‚¹ã®è‡ªå‹•åŒæœŸ
- **REST API**: è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹é«˜æ€§èƒ½API
- **å®Ÿç¸¾**: å®‰å®šã—ãŸãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

**AWS Amplifyï¼ˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼‰**:

- **ç°¡å˜ãƒ‡ãƒ—ãƒ­ã‚¤**: GitHubã¨ã®è‡ªå‹•é€£æº
- **ã‚°ãƒ­ãƒ¼ãƒãƒ«CDN**: ä¸–ç•Œä¸­ã§é«˜é€Ÿé…ä¿¡
- **è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**: ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯å¢—åŠ ã«è‡ªå‹•å¯¾å¿œ
- **ã‚³ã‚¹ãƒˆåŠ¹ç‡**: ä½¿ç”¨é‡ãƒ™ãƒ¼ã‚¹èª²é‡‘
- **AWSçµ±åˆ**: å°†æ¥çš„ãªæ©Ÿèƒ½æ‹¡å¼µã«å¯¾å¿œ

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤

- **App**: ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€PWA åˆæœŸåŒ–
- **Router**: ãƒšãƒ¼ã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç†
- **Layout**: å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

#### 2. ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- **HomePage**: ä¿è‚²åœ’ã‚«ãƒ¼ãƒ‰ä¸€è¦§ã€æ–°è¦ä¿è‚²åœ’è¿½åŠ ãƒœã‚¿ãƒ³
- **NurseryDetailPage**: ä¿è‚²åœ’è©³ç´°ã€è¦‹å­¦æ—¥è¨­å®šã€è³ªå•ãƒªã‚¹ãƒˆç®¡ç†ã€å›ç­”å…¥åŠ›
- **TemplatePage**: è³ªå•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠãƒ»ç®¡ç†
- **SettingsPage**: ã‚¢ãƒ—ãƒªè¨­å®šã€ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- **PrintPage**: å°åˆ·ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

#### 3. æ©Ÿèƒ½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- **NurseryCard**: ä¿è‚²åœ’ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
- **NurseryForm**: ä¿è‚²åœ’æƒ…å ±å…¥åŠ›ãƒ»ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
- **VisitSessionCard**: è¦‹å­¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
- **VisitSessionForm**: è¦‹å­¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆãƒ»ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
- **QuestionItem**: å€‹åˆ¥è³ªå•è¡¨ç¤ºãƒ»ç·¨é›†
- **AnswerInput**: å›ç­”å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
- **InsightsSection**: æ°—ã¥ãã‚¿ã‚°ç®¡ç†ï¼ˆã‚¿ã‚°è¿½åŠ ãƒ»è¡¨ç¤ºãƒ»å‰Šé™¤æ©Ÿèƒ½ä»˜ãï¼‰
- **InsightTagInput**: æ°—ã¥ãã‚¿ã‚°å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
- **InsightTag**: å€‹åˆ¥ã‚¿ã‚°è¡¨ç¤ºãƒ»å‰Šé™¤ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **TemplateSelector**: è³ªå•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ
- **SyncIndicator**: åŒæœŸçŠ¶æ³è¡¨ç¤º
- **OfflineIndicator**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹è¡¨ç¤º
- **ShareModal**: å…±æœ‰è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

#### Nurseryï¼ˆä¿è‚²åœ’ï¼‰

```typescript
interface Nursery {
  id: string;
  name: string;
  visitSessions: VisitSession[];
  createdAt: Date;
  updatedAt: Date;
}
```

#### VisitSessionï¼ˆè¦‹å­¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰

```typescript
interface VisitSession {
  id: string;
  visitDate: Date;
  status: 'planned' | 'completed' | 'cancelled';
  questions: Question[];
  insights?: string[]; // æ°—ã¥ãã‚¿ã‚°ã®é…åˆ—ï¼ˆã‚¿ã‚°å½¢å¼ã§ç®¡ç†ï¼‰
  sharedWith?: string[]; // å…±æœ‰ç›¸æ‰‹ã®ID
  createdAt: Date;
  updatedAt: Date;
}
```

#### Questionï¼ˆè³ªå•ï¼‰

```typescript
interface Question {
  id: string;
  text: string;
  answer?: string;
  isAnswered: boolean;
  answeredBy?: string; // å›ç­”è€…ID
  answeredAt?: Date;
  createdAt: Date;
  updatedAt: Date;
}
```

#### QuestionTemplateï¼ˆè³ªå•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰

```typescript
interface QuestionTemplate {
  id: string;
  title: string;
  description?: string;
  ageGroup?: string; // '0-1æ­³', '1-2æ­³', '2-3æ­³', 'ä¸€èˆ¬'
  questions: Omit<
    Question,
    'id' | 'answer' | 'isAnswered' | 'answeredBy' | 'answeredAt'
  >[];
  createdAt: Date;
  updatedAt: Date;
}
```

#### SyncStateï¼ˆåŒæœŸçŠ¶æ…‹ï¼‰

```typescript
interface SyncState {
  isOnline: boolean;
  lastSyncAt?: Date;
  pendingChanges: number;
  conflictResolution?: 'local' | 'remote' | 'manual';
}
```

## ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆ

### API è¨­è¨ˆï¼ˆå†…éƒ¨ï¼‰

#### ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ï¼ˆIndexedDBï¼‰

```typescript
class DataStore {
  // è³ªå•ãƒªã‚¹ãƒˆç®¡ç†
  async createQuestionList(list: QuestionList): Promise<string>;
  async getQuestionList(id: string): Promise<QuestionList | null>;
  async updateQuestionList(
    id: string,
    updates: Partial<QuestionList>
  ): Promise<void>;
  async deleteQuestionList(id: string): Promise<void>;
  async getAllQuestionLists(): Promise<QuestionList[]>;

  // è³ªå•ç®¡ç†
  async updateQuestion(
    listId: string,
    questionId: string,
    updates: Partial<Question>
  ): Promise<void>;
  async addQuestion(
    listId: string,
    question: Omit<Question, 'id'>
  ): Promise<string>;
  async deleteQuestion(listId: string, questionId: string): Promise<void>;

  // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†
  async getTemplates(): Promise<QuestionList[]>;
  async createFromTemplate(
    templateId: string,
    customizations: Partial<QuestionList>
  ): Promise<string>;
}
```

#### Supabase ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆèªè¨¼ãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰

```typescript
class SupabaseAuthService {
  // OAuthèªè¨¼ç®¡ç†
  async signInWithGoogle(): Promise<User>;
  async signInWithLine(): Promise<User>;
  async signOut(): Promise<void>;
  async getCurrentUser(): Promise<User | null>;
  async getSession(): Promise<Session | null>;
}

class SupabaseRealtimeService {
  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
  subscribeToQuestionList(
    listId: string,
    callback: (payload: any) => void
  ): RealtimeSubscription;

  broadcastQuestionUpdate(listId: string, questionData: any): Promise<void>;

  subscribeToUserPresence(
    listId: string,
    callback: (users: any[]) => void
  ): RealtimeSubscription;
}
```

#### Supabase API ã‚µãƒ¼ãƒ“ã‚¹

```typescript
class SupabaseAPIService {
  // è³ªå•ãƒªã‚¹ãƒˆç®¡ç†ï¼ˆPostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰
  async createQuestionList(
    list: Omit<QuestionList, 'id' | 'createdAt' | 'updatedAt'>
  ): Promise<QuestionList>;

  async getQuestionLists(): Promise<QuestionList[]>;

  async updateQuestionList(
    id: string,
    updates: Partial<QuestionList>
  ): Promise<QuestionList>;

  async deleteQuestionList(id: string): Promise<void>;

  // å…±æœ‰æ©Ÿèƒ½
  async shareQuestionList(listId: string, email: string): Promise<void>;

  async getSharedLists(): Promise<QuestionList[]>;

  async removeShare(listId: string, userId: string): Promise<void>;

  // åŒæœŸçŠ¶æ…‹ç®¡ç†
  getSyncState(): SyncState;
  onSyncStateChange(callback: (state: SyncState) => void): void;
}
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒï¼ˆSupabase - PostgreSQLï¼‰

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆSupabase Authã¨é€£æºï¼‰
CREATE TABLE profiles (
  id UUID REFERENCES auth.users(id) PRIMARY KEY,
  email TEXT UNIQUE,
  display_name TEXT,
  provider TEXT NOT NULL, -- 'google', 'line' ãªã©
  provider_id TEXT NOT NULL, -- ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  avatar_url TEXT, -- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURL
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(provider, provider_id)
);

-- è³ªå•ãƒªã‚¹ãƒˆ
CREATE TABLE question_lists (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  title TEXT NOT NULL,
  nursery_name TEXT,
  visit_date DATE,
  owner_id UUID REFERENCES profiles(id) NOT NULL,
  is_template BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- è³ªå•
CREATE TABLE questions (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  list_id UUID REFERENCES question_lists(id) ON DELETE CASCADE,
  text TEXT NOT NULL,
  answer TEXT,
  is_answered BOOLEAN DEFAULT FALSE,
  answered_by UUID REFERENCES profiles(id),
  answered_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- å…±æœ‰è¨­å®š
CREATE TABLE question_list_shares (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  list_id UUID REFERENCES question_lists(id) ON DELETE CASCADE,
  shared_with UUID REFERENCES profiles(id) ON DELETE CASCADE,
  permission TEXT CHECK (permission IN ('read', 'write')) DEFAULT 'write',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(list_id, shared_with)
);

-- Row Level Security (RLS) ãƒãƒªã‚·ãƒ¼
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE question_lists ENABLE ROW LEVEL SECURITY;
ALTER TABLE questions ENABLE ROW LEVEL SECURITY;
ALTER TABLE question_list_shares ENABLE ROW LEVEL SECURITY;

-- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¯è‡ªåˆ†ã®ã‚‚ã®ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
CREATE POLICY "Users can view own profile" ON profiles FOR SELECT USING (auth.uid() = id);
CREATE POLICY "Users can update own profile" ON profiles FOR UPDATE USING (auth.uid() = id);

-- è³ªå•ãƒªã‚¹ãƒˆã¯æ‰€æœ‰è€…ã¾ãŸã¯å…±æœ‰ç›¸æ‰‹ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
CREATE POLICY "Users can view own question lists" ON question_lists FOR SELECT USING (
  auth.uid() = owner_id OR
  auth.uid() IN (SELECT shared_with FROM question_list_shares WHERE list_id = question_lists.id)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰
CREATE INDEX idx_question_lists_owner ON question_lists(owner_id);
CREATE INDEX idx_questions_list ON questions(list_id);
CREATE INDEX idx_shares_list ON question_list_shares(list_id);
CREATE INDEX idx_shares_user ON question_list_shares(shared_with);
```

#### ãƒ‡ãƒ¼ã‚¿åŒæœŸãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant F as Frontend
    participant S as Supabase API
    participant R as Supabase Realtime
    participant D as PostgreSQL

    F->>S: è³ªå•ãƒªã‚¹ãƒˆä½œæˆ (JWTä»˜ã)
    S->>S: JWTæ¤œè¨¼ & RLSé©ç”¨
    S->>D: ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    S->>F: ä½œæˆå®Œäº†ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    S->>R: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥é€ä¿¡
    R->>F: ä»–ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é…ä¿¡
    F->>F: UIæ›´æ–°
```

### UI/UX è¨­è¨ˆåŸå‰‡

#### ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆè¨­è¨ˆ

- **ã‚¿ãƒƒãƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆ**: æœ€å° 44pxÃ—44px
- **ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º**: æœ€å° 16pxï¼ˆã‚ºãƒ¼ãƒ é˜²æ­¢ï¼‰
- **å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: å¤§ãã‚ã®ã‚¿ãƒƒãƒ—ã‚¨ãƒªã‚¢
- **ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«**: æ…£æ€§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ

#### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³

- **ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ**:
  - Mobile: 320px-768px
  - Tablet: 768px-1024px
  - Desktop: 1024px+

#### ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

- **ARIA å±æ€§**: é©åˆ‡ãªãƒ©ãƒ™ãƒªãƒ³ã‚°
- **ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: Tab é †åºã®æœ€é©åŒ–
- **ã‚«ãƒ©ãƒ¼ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ**: WCAG AA æº–æ‹ 
- **ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼**: å¯¾å¿œ

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼åˆ†é¡ã¨å¯¾å¿œ

#### 1. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼

- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹**: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ç¶™ç¶šå‹•ä½œ
- **åŒæœŸå¤±æ•—**: å†è©¦è¡Œæ©Ÿèƒ½ã€æ‰‹å‹•åŒæœŸã‚ªãƒ—ã‚·ãƒ§ãƒ³
- **æ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

#### 2. ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼

- **ä¿å­˜å¤±æ•—**: è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã€ãƒ‡ãƒ¼ã‚¿å¾©æ—§æ©Ÿèƒ½
- **ç«¶åˆç™ºç”Ÿ**: ç«¶åˆè§£æ±º UIã€ãƒãƒ¼ã‚¸æ©Ÿèƒ½
- **ãƒ‡ãƒ¼ã‚¿ç ´æ**: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰ã®å¾©å…ƒ

#### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ©ãƒ¼

- **å…¥åŠ›æ¤œè¨¼**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **æ“ä½œãƒŸã‚¹**: Undo/Redo æ©Ÿèƒ½
- **èª¤å‰Šé™¤**: å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã€ã‚´ãƒŸç®±æ©Ÿèƒ½

### ã‚¨ãƒ©ãƒ¼ç›£è¦–

```typescript
class ErrorHandler {
  logError(error: Error, context: string): void;
  showUserFriendlyMessage(error: Error): void;
  reportCriticalError(error: Error): void;
  recoverFromError(error: Error): Promise<boolean>;
}
```

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ï¼ˆTDD æ¡ç”¨ï¼‰

### TDDï¼ˆãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

#### Red-Green-Refactor ã‚µã‚¤ã‚¯ãƒ«

1. **Red**: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
2. **Green**: ãƒ†ã‚¹ãƒˆã‚’é€šã™æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
3. **Refactor**: ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„ã™ã‚‹

#### ãƒ†ã‚¹ãƒˆåˆ†é¡ï¼ˆt-wada æµï¼‰

#### 1. å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆUnit Testï¼‰- 70%

**ç›®çš„**: å€‹åˆ¥ã®é–¢æ•°ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‹•ä½œç¢ºèª

```typescript
// ä¾‹: è³ªå•ã®å›ç­”çŠ¶æ…‹æ›´æ–°
describe('Question', () => {
  test('å›ç­”ã‚’å…¥åŠ›ã™ã‚‹ã¨ isAnswered ãŒ true ã«ãªã‚‹', () => {
    // Red: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å…ˆã«æ›¸ã
    const question = new Question('è³ªå•å†…å®¹');
    question.setAnswer('å›ç­”å†…å®¹');
    expect(question.isAnswered).toBe(true);
  });
});
```

**å¯¾è±¡**:

- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯é–¢æ•°
- React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆReact Testing Libraryï¼‰
- ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

#### 2. çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆIntegration Testï¼‰- 20%

**ç›®çš„**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®é€£æºç¢ºèª

```typescript
// ä¾‹: è³ªå•ãƒªã‚¹ãƒˆä½œæˆãƒ•ãƒ­ãƒ¼
describe("è³ªå•ãƒªã‚¹ãƒˆä½œæˆ", () => {
  test("ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰è³ªå•ãƒªã‚¹ãƒˆã‚’ä½œæˆã§ãã‚‹", async () => {
    // Red: çµ±åˆçš„ãªå‹•ä½œã®ãƒ†ã‚¹ãƒˆã‚’å…ˆã«æ›¸ã
    render(<QuestionListCreator />);

    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ
    await user.click(screen.getByText("0æ­³å…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ"));

    // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
    await user.type(screen.getByLabelText("åœ’å"), "ãƒ†ã‚¹ãƒˆä¿è‚²åœ’");

    // ä¿å­˜
    await user.click(screen.getByText("ä¿å­˜"));

    // çµæœç¢ºèª
    expect(screen.getByText("è³ªå•ãƒªã‚¹ãƒˆãŒä½œæˆã•ã‚Œã¾ã—ãŸ")).toBeInTheDocument();
  });
});
```

**å¯¾è±¡**:

- ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®é€£æº
- ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ï¼ˆAPI â†’ Store â†’ Componentï¼‰
- Supabase ã¨ã®é€£æº

#### 3. E2E ãƒ†ã‚¹ãƒˆï¼ˆEnd-to-End Testï¼‰- 10%

**ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªå…¨ä½“ã®å‹•ä½œç¢ºèª

```typescript
// ä¾‹: è¦‹å­¦å½“æ—¥ã®ä½¿ç”¨ã‚·ãƒŠãƒªã‚ª
test('è¦‹å­¦å½“æ—¥: è³ªå•ãƒªã‚¹ãƒˆã‚’ä½¿ã£ã¦å›ç­”ã‚’è¨˜éŒ²ã§ãã‚‹', async ({ page }) => {
  // ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã§ç‰¹å®šï¼‰
  await page.goto('/login');
  await page.getByRole('button', { name: 'Googleã§ãƒ­ã‚°ã‚¤ãƒ³' }).click();

  // è³ªå•ãƒªã‚¹ãƒˆé¸æŠï¼ˆè¦‹å‡ºã—ã§ç‰¹å®šï¼‰
  await page.getByRole('heading', { name: 'ä¿è‚²åœ’è¦‹å­¦è³ªå•ãƒªã‚¹ãƒˆ' }).click();

  // è³ªå•ã«å›ç­”ï¼ˆãƒ©ãƒ™ãƒ«ã§ç‰¹å®šï¼‰
  const answerInput = page.getByLabelText('å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
  await answerInput.fill('å›ç­”å†…å®¹');
  await answerInput.press('Enter');

  // å›ç­”æ¸ˆã¿è³ªå•ãŒä¸‹ã«ç§»å‹•ã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆãƒ†ã‚­ã‚¹ãƒˆã§ç‰¹å®šï¼‰
  await expect(page.getByText('å›ç­”æ¸ˆã¿')).toBeVisible();
});
```

### TDD å®Ÿè·µã®ãŸã‚ã®ãƒ„ãƒ¼ãƒ«è¨­å®š

#### ãƒ†ã‚¹ãƒˆç’°å¢ƒ

- **ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼**: Vitestï¼ˆé«˜é€Ÿã€TypeScript å¯¾å¿œï¼‰
- **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ**: React Testing Library
- **E2E ãƒ†ã‚¹ãƒˆ**: Playwright
- **ãƒ¢ãƒƒã‚¯**: MSWï¼ˆMock Service Workerï¼‰
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: c8ï¼ˆVitest å†…è”µï¼‰

#### ãƒ†ã‚¹ãƒˆæ”¯æ´ãƒ„ãƒ¼ãƒ«

```typescript
// ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼
export const renderWithProviders = (ui: ReactElement) => {
  return render(ui, {
    wrapper: ({ children }) => (
      <QueryClient>
        <SupabaseProvider>{children}</SupabaseProvider>
      </QueryClient>
    ),
  });
};

// ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼
export const createMockQuestionList = (overrides = {}) => ({
  id: "mock-list-id",
  title: "ãƒ†ã‚¹ãƒˆè³ªå•ãƒªã‚¹ãƒˆ",
  questions: [],
  createdAt: new Date(),
  ...overrides,
});

// ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãªãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼
export const testHelpers = {
  // ãƒ­ãƒ¼ãƒ«ãƒ»ãƒ©ãƒ™ãƒ«ãƒ»ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã®è¦ç´ å–å¾—
  getQuestionInput: (container: HTMLElement) =>
    screen.getByLabelText(/è³ªå•ã‚’å…¥åŠ›/i),
  getAnswerInput: (container: HTMLElement) =>
    screen.getByLabelText(/å›ç­”ã‚’å…¥åŠ›/i),
  getSaveButton: (container: HTMLElement) =>
    screen.getByRole("button", { name: /ä¿å­˜/i }),
  getQuestionList: (container: HTMLElement) =>
    screen.getByRole("list", { name: /è³ªå•ãƒªã‚¹ãƒˆ/i }),
};
```

### TDD é–‹ç™ºãƒ•ãƒ­ãƒ¼ä¾‹

#### æ©Ÿèƒ½é–‹ç™ºã®æµã‚Œ

1. **è¦ä»¶ç†è§£**: å—å…¥åŸºæº–ã‚’ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«å¤‰æ›
2. **Red**: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
3. **Green**: æœ€å°é™ã®å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆã‚’é€šã™
4. **Refactor**: ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„ï¼ˆãƒ†ã‚¹ãƒˆã¯å¤‰æ›´ã—ãªã„ï¼‰
5. **ç¹°ã‚Šè¿”ã—**: æ¬¡ã®æ©Ÿèƒ½ã«é€²ã‚€

#### ç¶™ç¶šçš„æ”¹å–„

- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãç¿’æ…£
- **å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—**: ä¸€åº¦ã«ä¸€ã¤ã®æ©Ÿèƒ½ã®ã¿å®Ÿè£…
- **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**: å‹•ä½œã‚’å¤‰ãˆãšã«ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„
- **ãƒ†ã‚¹ãƒˆã®ä¿å®ˆ**: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚‚å“è³ªã‚’ä¿ã¤

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### ãƒ‡ãƒ¼ã‚¿ä¿è­·

#### æš—å·åŒ–

```typescript
class CryptoService {
  async encryptData(data: string, key: CryptoKey): Promise<ArrayBuffer>;
  async decryptData(
    encryptedData: ArrayBuffer,
    key: CryptoKey
  ): Promise<string>;
  async generateKey(): Promise<CryptoKey>;
  async deriveKey(password: string, salt: Uint8Array): Promise<CryptoKey>;
}
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

- **ä½œæˆæ™‚**: è‡ªå‹•æš—å·åŒ–
- **ä¿å­˜æ™‚**: IndexedDB å†…ã§æš—å·åŒ–çŠ¶æ…‹
- **èª­ã¿è¾¼ã¿æ™‚**: è‡ªå‹•å¾©å·åŒ–
- **å‰Šé™¤æ™‚**: å®Œå…¨å‰Šé™¤ï¼ˆã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰

### ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·

- **ãƒ­ã‚°è¨˜éŒ²**: å€‹äººæƒ…å ±é™¤å¤–
- **ã‚¨ãƒ©ãƒ¼å ±å‘Š**: åŒ¿ååŒ–
- **åˆ†æãƒ‡ãƒ¼ã‚¿**: åé›†ã—ãªã„ï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼‰

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### èª­ã¿è¾¼ã¿æœ€é©åŒ–

- **ã‚³ãƒ¼ãƒ‰åˆ†å‰²**: React.lazy + Suspense
- **ãƒªã‚½ãƒ¼ã‚¹æœ€é©åŒ–**: ç”»åƒåœ§ç¸®ã€ãƒ•ã‚©ãƒ³ãƒˆæœ€é©åŒ–
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**: Service Worker æ´»ç”¨

### å®Ÿè¡Œæ™‚æœ€é©åŒ–

- **ä»®æƒ³åŒ–**: å¤§é‡è³ªå•ãƒªã‚¹ãƒˆå¯¾å¿œ
- **ãƒ‡ãƒã‚¦ãƒ³ã‚¹**: å…¥åŠ›å‡¦ç†æœ€é©åŒ–
- **ãƒ¡ãƒ¢åŒ–**: React.memo, useMemo æ´»ç”¨

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœ€é©åŒ–

- **ãƒ‡ãƒ¼ã‚¿åœ§ç¸®**: ä¿å­˜å‰åœ§ç¸®
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: æ¤œç´¢æ€§èƒ½å‘ä¸Š
- **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ä¸è¦ãƒ‡ãƒ¼ã‚¿è‡ªå‹•å‰Šé™¤

## ã‚·ãƒ³ãƒ—ãƒ«UIè¨­è¨ˆï¼ˆ2025å¹´7æœˆæ”¹è¨‚ï¼‰

### UIç°¡ç´ åŒ–ã®èƒŒæ™¯

æ—¢å­˜ã®è¨­è¨ˆã§ã¯ã€Œãƒ›ãƒ¼ãƒ ã€ã€Œä¿è‚²åœ’ç®¡ç†ã€ã€Œæ–°è¦ä½œæˆã€ã¨è¤‡æ•°ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå„æ©Ÿèƒ½ã®å½¹å‰²ã‚’ç†è§£ã—ã«ãã„çŠ¶æ³ã§ã—ãŸã€‚ã“ã‚Œã‚’ä¿è‚²åœ’ä¸­å¿ƒã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ•ãƒ­ãƒ¼ã«å¤‰æ›´ã—ã¾ã™ã€‚

### æ–°ã—ã„ç”»é¢æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¿è‚²åœ’è¦‹å­¦ã‚¢ãƒ—ãƒª        â”‚  â† ã‚¢ãƒ—ãƒªãƒ˜ãƒƒãƒ€ãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ï¼‹ ä¿è‚²åœ’ã‚’è¿½åŠ ã™ã‚‹]   â”‚  â† ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â—‹â—‹ä¿è‚²åœ’           â”‚ â”‚  â† ä¿è‚²åœ’ã‚«ãƒ¼ãƒ‰
â”‚ â”‚ è¦‹å­¦æ—¥: 2/15(åœŸ)   â”‚ â”‚     ï¼ˆã‚¿ãƒƒãƒ—ã§è©³ç´°ã¸ï¼‰
â”‚ â”‚ è³ªå•é€²æ—: 3/10     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â–³â–³ä¿è‚²åœ’           â”‚ â”‚
â”‚ â”‚ è¦‹å­¦æ—¥: æœªå®š       â”‚ â”‚
â”‚ â”‚ è³ªå•é€²æ—: 0/10     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸»è¦ãªå¤‰æ›´ç‚¹

1. **ãƒ›ãƒ¼ãƒ ç”»é¢ = ä¿è‚²åœ’ä¸€è¦§**
   - ä¿è‚²åœ’ã‚«ãƒ¼ãƒ‰ã‚’ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã—ã¦è¡¨ç¤º
   - ä¸€ç›®ã§è¦‹å­¦çŠ¶æ³ã¨è³ªå•é€²æ—ã‚’æŠŠæ¡å¯èƒ½

2. **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç°¡ç´ åŒ–**
   - ã€Œä¿è‚²åœ’ç®¡ç†ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å‰Šé™¤
   - ã€Œæ–°è¦ä½œæˆã€ã‚’ã€Œï¼‹ ä¿è‚²åœ’ã‚’è¿½åŠ ã™ã‚‹ã€ã«å¤‰æ›´
   - ç”»é¢é·ç§»ã‚’æœ€å°é™ã«æŠ‘åˆ¶

3. **ä¿è‚²åœ’è©³ç´°ç”»é¢ã®çµ±åˆ**
   - è¦‹å­¦æ—¥è¨­å®š
   - è³ªå•ãƒªã‚¹ãƒˆç®¡ç†
   - å›ç­”å…¥åŠ›
   - ä¿è‚²åœ’æƒ…å ±ç·¨é›†
   - ã™ã¹ã¦ã‚’1ã¤ã®ç”»é¢ã«é›†ç´„

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã®æ”¹å–„

```
1. ã‚¢ãƒ—ãƒªèµ·å‹• â†’ ä¿è‚²åœ’ä¸€è¦§ï¼ˆãƒ›ãƒ¼ãƒ ï¼‰
2. ä¿è‚²åœ’ã‚«ãƒ¼ãƒ‰ã‚¿ãƒƒãƒ— â†’ ä¿è‚²åœ’è©³ç´°
3. è©³ç´°ç”»é¢ã§å…¨ã¦ã®æ“ä½œãŒå®Œçµ
   - è¦‹å­¦æ—¥ã®è¨­å®š
   - è³ªå•ã®è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
   - å›ç­”ã®å…¥åŠ›
   - ä¿è‚²åœ’æƒ…å ±ã®ç·¨é›†
```

### æŠ€è¡“çš„ãªå¤‰æ›´

- `HomePage` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä¿è‚²åœ’ä¸€è¦§è¡¨ç¤ºã«å¤‰æ›´
- ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ `/` ã¨ `/nursery/:id` ã®2ã¤ã«ç°¡ç´ åŒ–
- ä¸è¦ãªãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‰Šé™¤

## åˆ†æãƒ»ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ©Ÿèƒ½è¨­è¨ˆ

### åˆ†ææ©Ÿèƒ½ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PWA Frontend              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   React     â”‚ â”‚ Analytics Layer â”‚â”‚
â”‚  â”‚ Components  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ GA4 Service â”‚ â”‚â”‚
â”‚                  â”‚ â”‚ Clarity SDK â”‚ â”‚â”‚
â”‚                  â”‚ â”‚ Privacy Mgr â”‚ â”‚â”‚
â”‚                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google Analyticsâ”‚ â”‚ Microsoft       â”‚
â”‚ 4 (GA4)         â”‚ â”‚ Clarity         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†ææ©Ÿèƒ½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

#### 1. åˆ†æã‚µãƒ¼ãƒ“ã‚¹å±¤

```typescript
// åˆ†æã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†
interface AnalyticsEvent {
  name: string;
  parameters?: Record<string, any>;
  timestamp: Date;
}

interface AnalyticsService {
  // åˆæœŸåŒ–
  initialize(): Promise<void>;
  // åŒæ„ç®¡ç†
  setConsent(consent: boolean): void;
  getConsent(): boolean;
  disable(): void;
  // ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡
  trackPageView(page: string): void;
  trackEvent(event: AnalyticsEvent): void;
  // ä¸»è¦ã‚¤ãƒ™ãƒ³ãƒˆ
  trackNurseryCreated(nurseryId: string): void;
  trackQuestionAdded(nurseryId: string, questionCount: number): void;
  trackInsightAdded(nurseryId: string, insightCount: number): void;
  trackNurseryDeleted(nurseryId: string): void;
  trackInsightsViewed(nurseryId: string): void;
}

// Google Analytics 4 å®Ÿè£…
class GA4Service implements AnalyticsService {
  private isEnabled = false;
  private consentGiven = false;
  private measurementId: string = (import.meta as any).env
    .VITE_GA4_MEASUREMENT_ID as string;
  private gtag: any;

  async initialize(): Promise<void> {
    if (!this.consentGiven) return;
    if ((import.meta as any).env.VITE_ANALYTICS_ENABLED === 'false') return;
    if (navigator.doNotTrack === '1') return;

    // GA4ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‹•çš„èª­ã¿è¾¼ã¿
    await this.loadGA4Script();
    this.isEnabled = true;
  }

  setConsent(consent: boolean): void {
    this.consentGiven = consent;
    if (!consent) this.disable();

    // Consent Mode v2: åŒæ„çŠ¶æ…‹ã‚’æ›´æ–°
    if (consent && (window as any).gtag) {
      (window as any).gtag('consent', 'update', {
        ad_storage: 'granted',
        analytics_storage: 'granted',
      });
    }
  }

  getConsent(): boolean {
    return this.consentGiven;
  }

  disable(): void {
    this.isEnabled = false;
    // Consent Mode v2: å…¨ã¦ denied ã«æ›´æ–°
    if ((window as any).gtag) {
      (window as any).gtag('consent', 'update', {
        ad_storage: 'denied',
        analytics_storage: 'denied',
      });
    }
  }

  private async loadGA4Script(): Promise<void> {
    const script = document.createElement('script');
    script.async = true;
    script.src = `https://www.googletagmanager.com/gtag/js?id=${this.measurementId}`;
    document.head.appendChild(script);

    // gtagé–¢æ•°ã®åˆæœŸåŒ–
    (window as any).dataLayer = (window as any).dataLayer || [];
    (window as any).gtag = function () {
      (window as any).dataLayer.push(arguments);
    };
    (window as any).gtag('js', new Date());

    // Consent Mode v2: åˆæœŸã¯ denied
    (window as any).gtag('consent', 'default', {
      ad_storage: 'denied',
      analytics_storage: 'denied',
    });

    (window as any).gtag('config', this.measurementId, {
      anonymize_ip: true,
      allow_google_signals: false,
      allow_ad_personalization_signals: false,
      // debug_mode ã¯é–‹ç™ºæ™‚ã®ã¿
      debug_mode: (import.meta as any).env.VITE_ANALYTICS_DEBUG === 'true',
    });
  }

  trackPageView(page: string): void {
    if (!this.isEnabled) return;

    (window as any).gtag('config', this.measurementId, {
      page_path: page,
    });
  }

  trackEvent(event: AnalyticsEvent): void {
    if (!this.isEnabled) return;

    (window as any).gtag('event', event.name, event.parameters);
  }

  trackNurseryCreated(nurseryId: string): void {
    this.trackEvent({
      name: 'nursery_created',
      parameters: { nursery_id: nurseryId },
      timestamp: new Date(),
    });
  }

  trackQuestionAdded(nurseryId: string, questionCount: number): void {
    this.trackEvent({
      name: 'question_added',
      parameters: { nursery_id: nurseryId, question_count: questionCount },
      timestamp: new Date(),
    });
  }

  trackInsightAdded(nurseryId: string, insightCount: number): void {
    this.trackEvent({
      name: 'insight_added',
      parameters: { nursery_id: nurseryId, insight_count: insightCount },
      timestamp: new Date(),
    });
  }

  trackNurseryDeleted(nurseryId: string): void {
    this.trackEvent({
      name: 'nursery_deleted',
      parameters: { nursery_id: nurseryId },
      timestamp: new Date(),
    });
  }

  trackInsightsViewed(nurseryId: string): void {
    this.trackEvent({
      name: 'insights_viewed',
      parameters: { nursery_id: nurseryId },
      timestamp: new Date(),
    });
  }
}

// Microsoft Clarity å®Ÿè£…
class ClarityService {
  private clarityId: string = (import.meta as any).env
    .VITE_CLARITY_PROJECT_ID as string;
  private isEnabled = false;
  private consentGiven = false;

  async initialize(): Promise<void> {
    if (!this.consentGiven) return;
    if ((import.meta as any).env.VITE_ANALYTICS_ENABLED === 'false') return;
    if (navigator.doNotTrack === '1') return;

    await this.loadClarityScript();
    this.setupDataMasking();
    this.isEnabled = true;
  }

  setConsent(consent: boolean): void {
    this.consentGiven = consent;
    if (!consent) this.disable();
  }

  getConsent(): boolean {
    return this.consentGiven;
  }

  disable(): void {
    this.isEnabled = false;
    if ((window as any).clarity) {
      (window as any).clarity('consent', false);
      (window as any).clarity('stop');
    }
  }

  private async loadClarityScript(): Promise<void> {
    const script = document.createElement('script');
    script.innerHTML = `
      (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "${this.clarityId}");
    `;
    document.head.appendChild(script);

    // å¯èƒ½ãªã‚‰ consent ã‚’ false ã§åˆæœŸåŒ–
    (window as any).clarity?.('consent', false);
  }

  private setupDataMasking(): void {
    // å€‹äººæƒ…å ±ã‚’å«ã‚€å¯èƒ½æ€§ã®ã‚ã‚‹è¦ç´ ã‚’ãƒã‚¹ã‚¯
    const sensitiveSelectors = [
      'input[type="text"]',
      'input[type="email"]',
      'input[type="tel"]',
      'input[type="password"]',
      'input[type="date"]',
      'input[type="datetime-local"]',
      'textarea',
      '[data-sensitive]',
    ];

    sensitiveSelectors.forEach((selector) => {
      document.querySelectorAll(selector).forEach((element) => {
        element.setAttribute('data-clarity-mask', 'true');
      });
    });

    // è¿½åŠ ã§ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã®ãƒã‚¹ã‚¯ã‚’æœ‰åŠ¹åŒ–
    (window as any).clarity?.('set', 'maskText', true);
  }
}
```

#### 2. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ç®¡ç†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è¨­å®šç®¡ç†
interface PrivacySettings {
  analyticsConsent: boolean;
  clarityConsent: boolean;
  consentTimestamp: Date;
  consentVersion: string;
}

class PrivacyManager {
  private settings: PrivacySettings;
  private storageKey = 'privacy-settings';

  constructor() {
    this.loadSettings();
  }

  // è¨­å®šã®èª­ã¿è¾¼ã¿
  private loadSettings(): void {
    const stored = localStorage.getItem(this.storageKey);
    if (stored) {
      this.settings = JSON.parse(stored);
      // Date ã‚’å¾©å…ƒ
      if (this.settings?.consentTimestamp) {
        this.settings.consentTimestamp = new Date(this.settings.consentTimestamp as any);
      }
    } else {
      this.settings = {
        analyticsConsent: false,
        clarityConsent: false,
        consentTimestamp: new Date(),
        consentVersion: '1.0'
      };
    }
  }

  // è¨­å®šã®ä¿å­˜
  private saveSettings(): void {
    localStorage.setItem(this.storageKey, JSON.stringify(this.settings));
  }

  // è¨­å®šã®å–å¾—ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰
  getSettings(): Readonly<PrivacySettings> {
    return this.settings;
  }

  getConsentTimestamp(): Date {
    return this.settings.consentTimestamp;
  }

  // åŒæ„çŠ¶æ…‹ã®å–å¾—
  getAnalyticsConsent(): boolean {
    return this.settings.analyticsConsent;
  }

  getClarityConsent(): boolean {
    return this.settings.clarityConsent;
  }

  // åŒæ„çŠ¶æ…‹ã®æ›´æ–°
  setAnalyticsConsent(consent: boolean): void {
    this.settings.analyticsConsent = consent;
    this.settings.consentTimestamp = new Date();
    this.saveSettings();
  }

  setClarityConsent(consent: boolean): void {
    this.settings.clarityConsent = consent;
    this.settings.consentTimestamp = new Date();
    this.saveSettings();
  }

  // å…¨ä½“åŒæ„ã®è¨­å®š
  setAllConsent(consent: boolean): void {
    this.settings.analyticsConsent = consent;
    this.settings.clarityConsent = consent;
    this.settings.consentTimestamp = new Date();
    this.saveSettings();
  }

  // åŒæ„ãŒå¿…è¦ã‹ã©ã†ã‹ã®åˆ¤å®š
  needsConsent(): boolean {
    return !this.settings.consentTimestamp ||
           this.isConsentExpired();
  }

  private isConsentExpired(): boolean {
    const expiryDays = 365; // 1å¹´é–“æœ‰åŠ¹
    const expiryDate = new Date(this.settings.consentTimestamp);
    expiryDate.setDate(expiryDate.getDate() + expiryDays);
    return new Date() > expiryDate;
  }
}

// React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
const CookieConsentBanner: React.FC = () => {
  const [isVisible, setIsVisible] = useState(false);
  const privacyManager = usePrivacyManager();

  useEffect(() => {
    setIsVisible(privacyManager.needsConsent());
  }, []);

  const handleAccept = () => {
    privacyManager.setAllConsent(true);
    setIsVisible(false);
    // åˆ†æã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆæœŸåŒ–ãƒ»åŒæ„åæ˜ 
    analyticsService.setConsent(true);
    clarityService.setConsent(true);
    analyticsService.initialize();
    clarityService.initialize();
  };

  const handleDecline = () => {
    privacyManager.setAllConsent(false);
    setIsVisible(false);
  };

  if (!isVisible) return null;

  return (
    <Box
      position="fixed"
      bottom={0}
      left={0}
      right={0}
      bg="white"
      p={4}
      boxShadow="lg"
      zIndex={1000}
    >
      <Text mb={3}>
        ã“ã®ã‚¢ãƒ—ãƒªã§ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹æ”¹å–„ã®ãŸã‚ã«Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã¨Microsoft Clarityã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
        å€‹äººã‚’ç‰¹å®šã™ã‚‹æƒ…å ±ã¯åé›†ã—ã¾ã›ã‚“ã€‚
      </Text>
      <HStack spacing={3}>
        <Button colorScheme="blue" onClick={handleAccept}>
          åŒæ„ã™ã‚‹
        </Button>
        <Button variant="outline" onClick={handleDecline}>
          æ‹’å¦ã™ã‚‹
        </Button>
        <Button as={Link} to="/privacy-policy" variant="ghost" size="sm">
          è©³ç´°
        </Button>
      </HStack>
    </Box>
  );
};

const PrivacySettingsPage: React.FC = () => {
  const privacyManager = usePrivacyManager();
  const [analyticsConsent, setAnalyticsConsent] = useState(
    privacyManager.getAnalyticsConsent()
  );
  const [clarityConsent, setClarityConsent] = useState(
    privacyManager.getClarityConsent()
  );

  const handleAnalyticsChange = (consent: boolean) => {
    setAnalyticsConsent(consent);
    privacyManager.setAnalyticsConsent(consent);

    if (consent) {
      analyticsService.initialize();
    } else {
      analyticsService.disable();
    }
  };

  const handleClarityChange = (consent: boolean) => {
    setClarityConsent(consent);
    privacyManager.setClarityConsent(consent);

    if (consent) {
      clarityService.initialize();
    } else {
      clarityService.disable();
    }
  };

  return (
    <VStack spacing={6} align="stretch">
      <Heading size="md">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è¨­å®š</Heading>

      <Box>
        <FormControl display="flex" alignItems="center">
          <FormLabel htmlFor="analytics-consent" mb="0">
            Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹
          </FormLabel>
          <Switch
            id="analytics-consent"
            isChecked={analyticsConsent}
            onChange={(e) => handleAnalyticsChange(e.target.checked)}
          />
        </FormControl>
        <Text fontSize="sm" color="gray.600" mt={1}>
          ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã¨æ©Ÿèƒ½ä½¿ç”¨çŠ¶æ³ã‚’åˆ†æã—ã¾ã™
        </Text>
      </Box>

      <Box>
        <FormControl display="flex" alignItems="center">
          <FormLabel htmlFor="clarity-consent" mb="0">
            Microsoft Clarity
          </FormLabel>
          <Switch
            id="clarity-consent"
            isChecked={clarityConsent}
            onChange={(e) => handleClarityChange(e.target.checked)}
          />
        </FormControl>
        <Text fontSize="sm" color="gray.600" mt={1}>
          ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã®éŒ²ç”»ã¨ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚’åé›†ã—ã¾ã™
        </Text>
      </Box>

      <Divider />

      <Box>
        <Text fontSize="sm" color="gray.600">
          æœ€çµ‚æ›´æ–°: {privacyManager.getConsentTimestamp().toLocaleDateString()}
        </Text>
        <Text fontSize="sm" color="gray.600">
          è¨­å®šã¯ã„ã¤ã§ã‚‚å¤‰æ›´ã§ãã¾ã™
        </Text>
      </Box>

      <Box mt={4}>
        <Link to="/privacy-policy" color="blue.500">
          ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’ç¢ºèªã™ã‚‹
        </Link>
      </Box>
    </VStack>
  );
};

// ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒšãƒ¼ã‚¸
const PrivacyPolicyPage: React.FC = () => {
  return (
    <Container maxW="4xl" py={8}>
      <VStack spacing={8} align="stretch">
        <Heading size="lg">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</Heading>

        <Text fontSize="sm" color="gray.600">
          æœ€çµ‚æ›´æ–°æ—¥: 2025å¹´8æœˆ15æ—¥
        </Text>

        <Box>
          <Heading size="md" mb={4}>1. ã¯ã˜ã‚ã«</Heading>
          <Text mb={4}>
            ä¿è‚²åœ’è¦‹å­¦è³ªå•ãƒªã‚¹ãƒˆã‚¢ãƒ—ãƒªï¼ˆä»¥ä¸‹ã€Œæœ¬ã‚¢ãƒ—ãƒªã€ï¼‰ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å°Šé‡ã—ã€
            å€‹äººæƒ…å ±ã®ä¿è­·ã«åŠªã‚ã¦ã„ã¾ã™ã€‚æœ¬ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã§ã¯ã€æœ¬ã‚¢ãƒ—ãƒªãŒã©ã®ã‚ˆã†ãªæƒ…å ±ã‚’
            åé›†ã—ã€ã©ã®ã‚ˆã†ã«ä½¿ç”¨ã™ã‚‹ã‹ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚
          </Text>
        </Box>

        <Box>
          <Heading size="md" mb={4}>2. åé›†ã™ã‚‹æƒ…å ±</Heading>
          <VStack align="stretch" spacing={3}>
            <Box>
              <Text fontWeight="bold" mb={2}>2.1 è‡ªå‹•çš„ã«åé›†ã•ã‚Œã‚‹æƒ…å ±</Text>
              <UnorderedList spacing={1} ml={4}>
                <ListItem>ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼æƒ…å ±ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ã—ãŸãƒšãƒ¼ã‚¸ã€æ»åœ¨æ™‚é–“ï¼‰</ListItem>
                <ListItem>ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®ç¨®é¡ã€OSã€ç”»é¢ã‚µã‚¤ã‚ºï¼‰</ListItem>
                <ListItem>ä½¿ç”¨æ©Ÿèƒ½ã®çµ±è¨ˆæƒ…å ±ï¼ˆä¿è‚²åœ’ä½œæˆã€è³ªå•è¿½åŠ ãªã©ï¼‰</ListItem>
                <ListItem>ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã‚¯ãƒªãƒƒã‚¯ä½ç½®ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‹•ä½œï¼‰</ListItem>
              </UnorderedList>
            </Box>

            <Box>
              <Text fontWeight="bold" mb={2}>2.2 åé›†ã—ãªã„æƒ…å ±</Text>
              <UnorderedList spacing={1} ml={4}>
                <ListItem>ä¿è‚²åœ’åã€è³ªå•å†…å®¹ã€å›ç­”å†…å®¹ãªã©ã®å€‹äººçš„ãªè¨˜éŒ²</ListItem>
                <ListItem>æ°åã€ä½æ‰€ã€é›»è©±ç•ªå·ãªã©ã®å€‹äººè­˜åˆ¥æƒ…å ±</ListItem>
                <ListItem>IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆåŒ¿ååŒ–å‡¦ç†ã‚’å®Ÿæ–½ï¼‰</ListItem>
                <ListItem>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ãã®ä»–ã®é€£çµ¡å…ˆæƒ…å ±</ListItem>
              </UnorderedList>
            </Box>
          </VStack>
        </Box>

        <Box>
          <Heading size="md" mb={4}>3. æƒ…å ±ã®ä½¿ç”¨ç›®çš„</Heading>
          <UnorderedList spacing={2} ml={4}>
            <ListItem>ã‚¢ãƒ—ãƒªã®æ©Ÿèƒ½æ”¹å–„ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã®å‘ä¸Š</ListItem>
            <ListItem>æŠ€è¡“çš„ãªå•é¡Œã®ç‰¹å®šã¨è§£æ±º</ListItem>
            <ListItem>æ–°æ©Ÿèƒ½ã®é–‹ç™ºã«ãŠã‘ã‚‹å„ªå…ˆé †ä½ã®æ±ºå®š</ListItem>
            <ListItem>ã‚¢ãƒ—ãƒªã®ä½¿ç”¨çŠ¶æ³ã®çµ±è¨ˆåˆ†æ</ListItem>
          </UnorderedList>
        </Box>

        <Box>
          <Heading size="md" mb={4}>4. ä½¿ç”¨ã™ã‚‹åˆ†æãƒ„ãƒ¼ãƒ«</Heading>
          <VStack align="stretch" spacing={4}>
            <Box>
              <Text fontWeight="bold" mb={2}>4.1 Google Analytics 4</Text>
              <Text mb={2}>
                ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã‚„æ©Ÿèƒ½ä½¿ç”¨çŠ¶æ³ã®åˆ†æã«ä½¿ç”¨ã—ã¾ã™ã€‚ä»¥ä¸‹ã®è¨­å®šã§ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¿è­·ã—ã¦ã„ã¾ã™ï¼š
              </Text>
              <UnorderedList spacing={1} ml={4}>
                <ListItem>IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®åŒ¿ååŒ–</ListItem>
                <ListItem>åºƒå‘Šæ©Ÿèƒ½ã®ç„¡åŠ¹åŒ–</ListItem>
                <ListItem>Googleã‚·ã‚°ãƒŠãƒ«ã®ç„¡åŠ¹åŒ–</ListItem>
                <ListItem>ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“ã®çŸ­ç¸®ï¼ˆ2ãƒ¶æœˆï¼‰</ListItem>
              </UnorderedList>
            </Box>

            <Box>
              <Text fontWeight="bold" mb={2}>4.2 Microsoft Clarity</Text>
              <Text mb={2}>
                ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã®éŒ²ç”»ã¨ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—åˆ†æã«ä½¿ç”¨ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ä¿è­·æªç½®ã‚’å®Ÿæ–½ã—ã¦ã„ã¾ã™ï¼š
              </Text>
              <UnorderedList spacing={1} ml={4}>
                <ListItem>å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å†…å®¹ã‚’è‡ªå‹•çš„ã«ãƒã‚¹ã‚¯</ListItem>
                <ListItem>å€‹äººæƒ…å ±ã‚’å«ã‚€å¯èƒ½æ€§ã®ã‚ã‚‹è¦ç´ ã®éè¡¨ç¤ºåŒ–</ListItem>
                <ListItem>Do Not Trackè¨­å®šã®å°Šé‡</ListItem>
              </UnorderedList>
            </Box>
          </VStack>
        </Box>

        <Box>
          <Heading size="md" mb={4}>5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é¸æŠã¨åˆ¶å¾¡</Heading>
          <VStack align="stretch" spacing={3}>
            <Text>
              ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä»¥ä¸‹ã®æ–¹æ³•ã§åˆ†ææ©Ÿèƒ½ã‚’åˆ¶å¾¡ã§ãã¾ã™ï¼š
            </Text>
            <UnorderedList spacing={2} ml={4}>
              <ListItem>åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®åŒæ„ãƒãƒŠãƒ¼ã§åˆ†ææ©Ÿèƒ½ã®ä½¿ç”¨ã‚’é¸æŠ</ListItem>
              <ListItem>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è¨­å®šãƒšãƒ¼ã‚¸ã§ã„ã¤ã§ã‚‚è¨­å®šã‚’å¤‰æ›´</ListItem>
              <ListItem>å€‹åˆ¥ã« Google Analytics ã¨ Microsoft Clarity ã‚’åˆ¶å¾¡</ListItem>
              <ListItem>ãƒ–ãƒ©ã‚¦ã‚¶ã® Do Not Track è¨­å®šã®åˆ©ç”¨</ListItem>
            </UnorderedList>
          </VStack>
        </Box>

        <Box>
          <Heading size="md" mb={4}>6. ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã¨å‰Šé™¤</Heading>
          <VStack align="stretch" spacing={3}>
            <Text>
              åé›†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ç®¡ç†ã•ã‚Œã¾ã™ï¼š
            </Text>
            <UnorderedList spacing={2} ml={4}>
              <ListItem>Google Analytics: 2ãƒ¶æœˆå¾Œã«è‡ªå‹•å‰Šé™¤</ListItem>
              <ListItem>Microsoft Clarity: 1å¹´å¾Œã«è‡ªå‹•å‰Šé™¤</ListItem>
              <ListItem>ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰å‰Šé™¤å¯èƒ½</ListItem>
              <ListItem>åŒæ„è¨­å®š: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¤‰æ›´ã™ã‚‹ã¾ã§ä¿æŒ</ListItem>
            </UnorderedList>
          </VStack>
        </Box>

        <Box>
          <Heading size="md" mb={4}>7. ç¬¬ä¸‰è€…ã¸ã®æƒ…å ±æä¾›</Heading>
          <Text>
            æœ¬ã‚¢ãƒ—ãƒªã¯ã€æ³•çš„è¦è«‹ãŒã‚ã‚‹å ´åˆã‚’é™¤ãã€åé›†ã—ãŸæƒ…å ±ã‚’ç¬¬ä¸‰è€…ã«æä¾›ã€è²©å£²ã€
            ã¾ãŸã¯å…±æœ‰ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚åˆ†æãƒ„ãƒ¼ãƒ«ã®æä¾›è€…ï¼ˆGoogleã€Microsoftï¼‰ã¯ã€
            ãã‚Œãã‚Œã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«å¾“ã£ã¦æƒ…å ±ã‚’å‡¦ç†ã—ã¾ã™ã€‚
          </Text>
        </Box>

        <Box>
          <Heading size="md" mb={4}>8. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</Heading>
          <Text>
            æœ¬ã‚¢ãƒ—ãƒªã¯ã€åé›†ã—ãŸæƒ…å ±ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã«é©åˆ‡ãªæŠ€è¡“çš„ãƒ»çµ„ç¹”çš„æªç½®ã‚’è¬›ã˜ã¦ã„ã¾ã™ã€‚
            ãŸã ã—ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã§ã®æƒ…å ±ä¼é€ã¯å®Œå…¨ã«å®‰å…¨ã§ã¯ãªã„ã“ã¨ã‚’ã”ç†è§£ãã ã•ã„ã€‚
          </Text>
        </Box>

        <Box>
          <Heading size="md" mb={4}>9. å­ã©ã‚‚ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</Heading>
          <Text>
            æœ¬ã‚¢ãƒ—ãƒªã¯13æ­³æœªæº€ã®å­ã©ã‚‚ã‹ã‚‰æ„å›³çš„ã«å€‹äººæƒ…å ±ã‚’åé›†ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
            13æ­³æœªæº€ã®å­ã©ã‚‚ã®æƒ…å ±ã‚’åé›†ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ¤æ˜ã—ãŸå ´åˆã€
            é€Ÿã‚„ã‹ã«å‰Šé™¤ã„ãŸã—ã¾ã™ã€‚
          </Text>
        </Box>

        <Box>
          <Heading size="md" mb={4}>10. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®å¤‰æ›´</Heading>
          <Text>
            æœ¬ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã¯å¿…è¦ã«å¿œã˜ã¦æ›´æ–°ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
            é‡è¦ãªå¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯ã€ã‚¢ãƒ—ãƒªå†…ã§é€šçŸ¥ã„ãŸã—ã¾ã™ã€‚
            ç¶™ç¶šã—ã¦ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€æ›´æ–°ã•ã‚ŒãŸãƒãƒªã‚·ãƒ¼ã«åŒæ„ã—ãŸã‚‚ã®ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚
          </Text>
        </Box>

        <Box>
          <Heading size="md" mb={4}>11. ãŠå•ã„åˆã‚ã›</Heading>
          <Text>
            æœ¬ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«é–¢ã™ã‚‹ã”è³ªå•ã‚„ã”æ„è¦‹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€
            ã‚¢ãƒ—ãƒªå†…ã®è¨­å®šãƒšãƒ¼ã‚¸ã‹ã‚‰ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚
          </Text>
        </Box>

        <Divider />

        <HStack justify="center" spacing={4}>
          <Button as={Link} to="/privacy-settings" colorScheme="blue">
            ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è¨­å®š
          </Button>
          <Button as={Link} to="/" variant="outline">
            ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
          </Button>
        </HStack>
      </VStack>
    </Container>
  );
};
```

#### 3. åˆ†æã‚¤ãƒ™ãƒ³ãƒˆçµ±åˆ

```typescript
// React Hook for Analytics
const useAnalytics = () => {
  const analyticsService = useContext(AnalyticsContext);

  const trackPageView = useCallback((page: string) => {
    analyticsService.trackPageView(page);
  }, [analyticsService]);

  const trackNurseryCreated = useCallback((nurseryId: string) => {
    analyticsService.trackNurseryCreated(nurseryId);
  }, [analyticsService]);

  const trackQuestionAdded = useCallback((nurseryId: string, questionCount: number) => {
    analyticsService.trackQuestionAdded(nurseryId, questionCount);
  }, [analyticsService]);

  const trackInsightAdded = useCallback((nurseryId: string, insightCount: number) => {
    analyticsService.trackInsightAdded(nurseryId, insightCount);
  }, [analyticsService]);

  return {
    trackPageView,
    trackNurseryCreated,
    trackQuestionAdded,
    trackInsightAdded
  };
};

// Router ãƒ¬ãƒ™ãƒ«ã§ã®ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼è¿½è·¡
const AnalyticsRouter: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const location = useLocation();
  const { trackPageView } = useAnalytics();

  useEffect(() => {
    trackPageView(location.pathname);
  }, [location.pathname, trackPageView]);

  return <>{children}</>;
};

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ä½¿ç”¨ä¾‹
const NurseryCreator: React.FC = () => {
  const { trackNurseryCreated } = useAnalytics();

  const handleCreateNursery = async (nurseryData: NurseryData) => {
    try {
      const nursery = await nurseryService.create(nurseryData);

      // åˆ†æã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡
      trackNurseryCreated(nursery.id);

      // æˆåŠŸå‡¦ç†
      navigate(`/nursery/${nursery.id}`);
    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼å‡¦ç†
    }
  };

  return (
    // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®JSX
  );
};
```

### ç’°å¢ƒè¨­å®šã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

#### ç’°å¢ƒå¤‰æ•°è¨­å®š

```typescript
// .env.local
VITE_GA4_MEASUREMENT_ID = G - XXXXXXXXXX;
VITE_CLARITY_PROJECT_ID = xxxxxxxxxx;
VITE_ANALYTICS_ENABLED = true;

// .env.development
VITE_ANALYTICS_DEBUG = true;
VITE_ANALYTICS_ENABLED = false;

// .env.production
VITE_ANALYTICS_DEBUG = false;
VITE_ANALYTICS_ENABLED = true;
```

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

```typescript
// Content Security Policy (CSP) è¨­å®š
const cspDirectives = {
  'script-src': [
    "'self'",
    "'unsafe-inline'", // GA4ã¨Clarityã§å¿…è¦
    'https://www.googletagmanager.com',
    'https://www.google-analytics.com',
    'https://www.clarity.ms',
  ],
  'connect-src': [
    "'self'",
    'https://www.google-analytics.com',
    'https://analytics.google.com',
    'https://www.clarity.ms',
  ],
  'img-src': [
    "'self'",
    'data:',
    'https://www.google-analytics.com',
    'https://www.googletagmanager.com',
  ],
};

// ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·è¨­å®š
const privacyConfig = {
  // GA4è¨­å®š
  ga4: {
    anonymize_ip: true,
    allow_google_signals: false,
    allow_ad_personalization_signals: false,
    cookie_expires: 60 * 60 * 24 * 30, // 30æ—¥
    storage: 'none', // Cookieã‚’ä½¿ç”¨ã—ãªã„
  },

  // Clarityè¨­å®š
  clarity: {
    maskTextContent: true,
    maskSensitiveElements: true,
    respectDoNotTrack: true,
  },
};
```

### ãƒ‡ãƒãƒƒã‚°ãƒ»ç›£è¦–æ©Ÿèƒ½

```typescript
// é–‹ç™ºç’°å¢ƒã§ã®ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½
class AnalyticsDebugger {
  private events: AnalyticsEvent[] = [];

  logEvent(event: AnalyticsEvent): void {
    if (import.meta.env.VITE_ANALYTICS_DEBUG === 'true') {
      console.group(`ğŸ“Š Analytics Event: ${event.name}`);
      console.log('Parameters:', event.parameters);
      console.log('Timestamp:', event.timestamp);
      console.groupEnd();

      this.events.push(event);
    }
  }

  getEventHistory(): AnalyticsEvent[] {
    return this.events;
  }

  clearHistory(): void {
    this.events = [];
  }
}

// ã‚¨ãƒ©ãƒ¼ç›£è¦–
class AnalyticsErrorHandler {
  handleScriptLoadError(service: 'ga4' | 'clarity', error: Error): void {
    console.warn(`Failed to load ${service} script:`, error);

    // ã‚¢ãƒ—ãƒªã®å‹•ä½œã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†ã«ã™ã‚‹
    // åˆ†ææ©Ÿèƒ½ã®ã¿ç„¡åŠ¹åŒ–
    if (service === 'ga4') {
      analyticsService.disable();
    } else if (service === 'clarity') {
      clarityService.disable();
    }
  }

  handleEventSendError(event: AnalyticsEvent, error: Error): void {
    console.warn('Failed to send analytics event:', event.name, error);

    // å¿…è¦ã«å¿œã˜ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã—ã¦å¾Œã§å†é€ä¿¡
    this.queueFailedEvent(event);
  }

  private queueFailedEvent(event: AnalyticsEvent): void {
    const failedEvents = JSON.parse(
      localStorage.getItem('failed-analytics-events') || '[]'
    );
    failedEvents.push(event);
    localStorage.setItem(
      'failed-analytics-events',
      JSON.stringify(failedEvents)
    );
  }
}
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

```typescript
// é…å»¶èª­ã¿è¾¼ã¿
class LazyAnalyticsLoader {
  private loaded = false;
  private pendingEvents: AnalyticsEvent[] = [];

  async loadWhenReady(): Promise<void> {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œãŒè½ã¡ç€ã„ã¦ã‹ã‚‰èª­ã¿è¾¼ã¿
    await this.waitForUserIdle();

    if (privacyManager.getAnalyticsConsent()) {
      await this.loadAnalyticsScripts();
      this.processPendingEvents();
      this.loaded = true;
    }
  }

  private async waitForUserIdle(): Promise<void> {
    return new Promise((resolve) => {
      if ('requestIdleCallback' in window) {
        requestIdleCallback(() => resolve());
      } else {
        setTimeout(() => resolve(), 2000);
      }
    });
  }

  trackEvent(event: AnalyticsEvent): void {
    if (this.loaded) {
      analyticsService.trackEvent(event);
    } else {
      this.pendingEvents.push(event);
    }
  }

  private processPendingEvents(): void {
    this.pendingEvents.forEach((event) => {
      analyticsService.trackEvent(event);
    });
    this.pendingEvents = [];
  }
}
```

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å°Šé‡ã—ãªãŒã‚‰åŠ¹æœçš„ãªåˆ†ææ©Ÿèƒ½ã‚’æä¾›ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®‰å¿ƒã—ã¦ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã§ãã‚‹ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
